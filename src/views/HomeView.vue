<template>
  <div class="w-full h-full bg-[#E8F4F2] flex flex-col overflow-hidden m-0 p-0">
    <!-- –í–µ—Ä—Ö–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
    <nav
      class="bg-[#E8F4F2] h-16 sm:h-20 lg:h-24 flex items-center justify-between px-4 sm:px-6 lg:px-8 shadow-sm w-full m-0 p-0"
    >
      <!-- –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è -->
      <div class="text-[#11AE78] font-bold text-lg sm:text-xl lg:text-2xl leading-tight">
        <div>{{ currentTime }}</div>
        <div class="text-[#14865E] text-sm sm:text-base lg:text-lg font-bold">{{ currentDate }}</div>
      </div>

      <!-- –ü—É—Å—Ç–æ–µ –º–µ—Å—Ç–æ –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ -->
      <div class="w-20 sm:w-24 lg:w-28"></div>
    </nav>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <main
      class="flex-1 flex flex-col items-center justify-center px-4 py-2 sm:py-4 bg-white"
    >
      <!-- –ó–∞–≥–æ–ª–æ–≤–∫–∏ -->
      <div class="text-center mb-4 sm:mb-6">
        <div
          class="text-[#11AE78] font-bold text-lg sm:text-xl lg:text-2xl mb-1 sm:mb-2 leading-tight"
          v-html="$t('choose_service')"
        ></div>
      </div>

      <!-- –í–∏–¥–µ–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
      <div class="mb-4 sm:mb-6">
        <div 
          class="video-container"
          :class="{ 'hide-video': isAnimating }"
        >
          <div
            class="w-[202px] h-[202px] sm:w-[186px] sm:h-[186px] lg:w-[250px] lg:h-[250px] xl:w-[274px] xl:h-[274px] rounded-full overflow-hidden shadow-lg bg-white video-glow gradient-border"
          >
            <video
              src="../assets/idle.mp4"
              autoplay
              muted
              loop
              class="w-[105%] h-[105%]"
              style="margin: -2.5% 0 0 -2.5%; object-fit: cover; object-position: center; filter: contrast(1.1) brightness(1.05) saturate(1.1) sharpen(0.5);"
            ></video>
          </div>
        </div>
      </div>

      <div class="flex flex-col gap-2 w-full max-w-md">
        <!-- –ü–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞ –∫–Ω–æ–ø–æ–∫ -->
        <div class="flex gap-4">
          <div
            @click="selectService('appointment')"
            class="flex-1 bg-gradient-to-r from-[#0C593E] to-[#14865E] hover:from-[#0A4A33] hover:to-[#117A52] text-white font-bold py-2 sm:py-3 lg:py-4 px-2 sm:px-4 lg:px-6 rounded-xl sm:rounded-2xl text-xs sm:text-base lg:text-lg cursor-pointer transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl"
          >
            <div class="flex flex-col items-start gap-1">
              <img
                src="../assets/appointment.svg"
                alt="appointment"
                class="w-4 h-4 sm:w-6 sm:h-6 lg:w-7 lg:h-7"
              />
              <p class="text-start text-xs sm:text-sm lg:text-base mb-0" v-html="$t('make_appointment')"></p>
            </div>
          </div>
          <div
            @click="selectService('help')"
            class="flex-1 bg-gradient-to-r from-[#14865E] to-[#11AE78] hover:from-[#117A52] hover:to-[#0E9A6A] text-white font-bold py-2 sm:py-3 lg:py-4 px-2 sm:px-4 lg:px-6 rounded-xl sm:rounded-2xl text-xs sm:text-base lg:text-lg cursor-pointer transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl"
          >
            <div class="flex flex-col items-start gap-1">
              <img src="../assets/help.svg" alt="help" class="w-4 h-4 sm:w-6 sm:h-6 lg:w-7 lg:h-7" />
              <p class="text-start text-xs sm:text-sm lg:text-base mb-0"  v-html="$t('help_center')"></p>
            </div>
          </div>
        </div>

        <!-- –í—Ç–æ—Ä–∞—è —Å—Ç—Ä–æ–∫–∞ - –∫–Ω–æ–ø–∫–∞ –ê–π–≥–µ—Ä–∏–º -->
        <div
          @click="selectService('aigerim')"
          class="w-full bg-gradient-to-r from-[#0C593E] to-[#14865E] hover:from-[#0A4A33] hover:to-[#117A52] text-white font-bold py-2 sm:py-3 lg:py-4 px-3 sm:px-4 lg:px-6 rounded-xl sm:rounded-2xl text-sm sm:text-base lg:text-lg cursor-pointer transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl"
        >
          <div class="flex items-center justify-between gap-3">
            <img src="../assets/chat.svg" alt="chat" class="w-5 h-5 sm:w-6 sm:h-6 lg:w-7 lg:h-7" />
            <div class="margin-auto">{{ $t("ask_aigerim") }}</div>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="white"
              class="w-5 h-5 sm:w-6 sm:h-6 lg:w-7 lg:h-7"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M17.25 8.25 21 12m0 0-3.75 3.75M21 12H3"
              />
            </svg>
          </div>
        </div>
      </div>
    </main>

    <!-- –ù–∏–∂–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
    <nav
      class="bg-[#E8F4F2] h-16 sm:h-18 lg:h-20 flex items-center justify-between shadow-sm w-full m-0 p-0"
    >
      <!-- –ü–æ–∏—Å–∫ -->
      <div class="flex-1 max-w-md ml-4 my-4">
        <div class="relative">
          <input
            type="text"
            :placeholder="$t('search_placeholder')"
            class="w-full px-3 sm:px-4 py-1.5 sm:py-2 pl-8 sm:pl-10 pr-8 sm:pr-10 text-xs sm:text-sm lg:text-base border-2 border-[#11AE78] bg-white rounded-xl sm:rounded-[14px] focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"
          />
          <div
            class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none"
          >
            <svg
              class="h-3 w-3 sm:h-4 sm:w-4 lg:h-5 lg:w-5 text-green-700 font-extrabold"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
              ></path>
            </svg>
          </div>
        </div>
      </div>

      <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —è–∑—ã–∫–∞ -->
      <div
        class="w-[100px] bg-gradient-to-r from-[#14865E] to-[#11AE78] h-full rounded-tl-[30%] ml-6 mr-0 flex items-center justify-center"
      >
        <div
          class="w-10 h-10 rounded-full bg-white flex items-center justify-center"
        >
          <span class="text-[#14865E] text-[10px] sm:text-xs lg:text-sm font-bold">
            {{ currentLanguage === "kk" ? "“ö–∞–∑" : "–†—É—Å" }}
          </span>
        </div>
      </div>
    </nav>
  </div>
</template>

<script setup lang="ts">
import { ref, onUnmounted, watch } from "vue";
import { useRouter, useRoute } from "vue-router";
import { useI18n } from "vue-i18n";
import { useDateTime } from "../composables/useDateTime";

const router = useRouter();
const route = useRoute();
const { locale } = useI18n();

// –ò—Å–ø–æ–ª—å–∑—É–µ–º –µ–¥–∏–Ω—ã–π composable –¥–ª—è –≤—Ä–µ–º–µ–Ω–∏ –∏ –¥–∞—Ç—ã
const { currentDate, currentTime } = useDateTime();

const currentLanguage = ref(locale.value);

// –°–æ—Å—Ç–æ—è–Ω–∏–µ –∞–Ω–∏–º–∞—Ü–∏–∏ –≤–∏–¥–µ–æ - –í–°–ï–ì–î–ê –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–∏–¥–µ–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
const isAnimating = ref(false);

console.log('üè† HomeView –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è - –≤–∏–¥–µ–æ –í–°–ï–ì–î–ê –ø–æ–∫–∞–∑–∞–Ω–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:', {
  isAnimating: isAnimating.value,
  sessionStorage: sessionStorage.getItem('shouldReturnAnimate')
});

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∞–Ω–∏–º–∞—Ü–∏–∏ –≤–æ–∑–≤—Ä–∞—Ç–∞
const startReturnAnimation = () => {
  console.log('üé¨ –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –≤–æ–∑–≤—Ä–∞—Ç–∞ –≤–∏–¥–µ–æ');
  
  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∏—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏
  const findAndAnimateContainer = (attempts = 0) => {
    const videoContainer = document.querySelector('.video-container');
    console.log(`üéØ –ü–æ–ø—ã—Ç–∫–∞ ${attempts + 1}: Video container found:`, !!videoContainer);
    
    if (videoContainer) {
      console.log('‚ú® –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ—Å—Ç—É—é –∞–Ω–∏–º–∞—Ü–∏—é');
      
      // –ü—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –∞–Ω–∏–º–∞—Ü–∏–∏ –∫ –≤–∏–¥–µ–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É
      videoContainer.classList.add('return-animation');
      
      console.log('üé¨ –ê–Ω–∏–º–∞—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É');
      
      // –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
      setTimeout(() => {
        videoContainer.classList.remove('return-animation');
        console.log('üèÅ –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞, –∫–ª–∞—Å—Å —É–±—Ä–∞–Ω');
      }, 1600);
    } else if (attempts < 10) {
      // –ü–æ–≤—Ç–æ—Ä—è–µ–º –ø–æ–ø—ã—Ç–∫—É —á–µ—Ä–µ–∑ 100ms, –º–∞–∫—Å–∏–º—É–º 10 –ø–æ–ø—ã—Ç–æ–∫
      setTimeout(() => findAndAnimateContainer(attempts + 1), 100);
    } else {
      console.error('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ video-container –ø–æ—Å–ª–µ 10 –ø–æ–ø—ã—Ç–æ–∫');
    }
  };
  
  // –ù–∞—á–∏–Ω–∞–µ–º –ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ 100ms
  setTimeout(() => findAndAnimateContainer(), 100);
};

// –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∞–Ω–∏–º–∞—Ü–∏–∏ –≤–æ–∑–≤—Ä–∞—Ç–∞
(window as any).startReturnAnimation = startReturnAnimation;

// –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –≤–æ–∑–≤—Ä–∞—Ç –Ω–∞ HomeView –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
watch(route, (newRoute) => {
  console.log('üîÑ Route change to:', newRoute.name, 'isAnimating:', isAnimating.value);
  if (newRoute.name === 'HomeView') {
    // –ü—Ä–æ—Å—Ç–æ —É–±–∏—Ä–∞–µ–º —Ñ–ª–∞–≥ –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å, –±–æ–ª—å—à–µ –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
    if (sessionStorage.getItem('shouldReturnAnimate') === 'true') {
      console.log('üé¨ –£–±–∏—Ä–∞–µ–º —Ñ–ª–∞–≥ –∞–Ω–∏–º–∞—Ü–∏–∏');
      sessionStorage.removeItem('shouldReturnAnimate');
    }
    console.log('üì∫ –í–∏–¥–µ–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤–∏–¥–∏–º–æ, isAnimating:', isAnimating.value);
  }
});

onUnmounted(() => {
  // –û—á–∏—Å—Ç–∫–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ —Ç–µ–ø–µ—Ä—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ useDateTime composable
});

const selectService = (service: string) => {
  console.log(`–í—ã–±—Ä–∞–Ω–∞ —É—Å–ª—É–≥–∞: ${service}`);
  if (service === "aigerim") {
    router.push("/chat");
  } else if (service === "appointment") {
    // –°–∫—Ä—ã–≤–∞–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–µ –≤–∏–¥–µ–æ –∏ –∑–∞–ø—É—Å–∫–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—É—é –∞–Ω–∏–º–∞—Ü–∏—é
    isAnimating.value = true;
    (window as any).startVideoTransition();
    
    // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —á–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É
    setTimeout(() => {
      router.push("/service");
    }, 100);
  }
  else if (service === "help") {
    router.push("/info-service");
  }
};
</script>

<style scoped>
/* –°–∫—Ä—ã—Ç–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –≤–∏–¥–µ–æ –ø—Ä–∏ –∞–Ω–∏–º–∞—Ü–∏–∏ */
.hide-video {
  opacity: 0;
  transition: opacity 0.1s ease-out;
}

/* –ü—Ä–æ—Å—Ç–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –≤–∏–¥–µ–æ */
.return-animation {
  animation: returnFromService 1.6s ease-out forwards;
}

@keyframes returnFromService {
  0% {
    transform: translate(200px, -200px) scale(0.5) rotate(45deg);
    opacity: 0.5;
  }
  50% {
    transform: translate(100px, -100px) scale(0.75) rotate(22deg);
    opacity: 0.8;
  }
  100% {
    transform: translate(0, 0) scale(1) rotate(0deg);
    opacity: 1;
  }
}

/* –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π –±–æ—Ä–¥–µ—Ä */
.gradient-border {
  position: relative;
}

.gradient-border::before {
  content: '';
  position: absolute;
  top: -4px;
  left: -4px;
  right: -4px;
  bottom: -4px;
  background: linear-gradient(45deg, #11AE78, #E8F4F2, #11AE78);
  border-radius: 50%;
  z-index: -1;
}
</style>
